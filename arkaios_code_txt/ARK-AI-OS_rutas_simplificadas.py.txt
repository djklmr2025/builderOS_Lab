ORIGINAL FILE: ARK-AI-OS/rutas_simplificadas.py
--- BEGIN CONTENT ---
# rutas_simplificadas.py (fragmento)
import stripe, os, secrets
stripe.api_key = os.environ["STRIPE_SECRET_KEY"]

@app.post("/api/pay/checkout")
def create_checkout():
  amount_aeio = int((request.json or {}).get("amount", 100))
  # precio en MXN: define tabla de conversión 1:1, o la que decidas
  amount_mxn = amount_aeio * 1  # 1 AEIO-MR = 1 MXN (ejemplo)
  session = stripe.checkout.Session.create(
    mode="payment",
    payment_method_types=["card"],
    line_items=[{
      "price_data":{
        "currency":"mxn",
        "product_data":{"name":f"Recarga {amount_aeio} AEIO-MR"},
        "unit_amount": amount_mxn * 100
      },
      "quantity":1
    }],
    success_url="https://tu-ui/ok",
    cancel_url="https://tu-ui/cancel"
  )
  # guarda en DB la intención ligada a account_id
  return jsonify({"checkout_url": session.url})

@app.post("/api/pay/stripe-webhook")
def stripe_webhook():
  payload = request.data
  sig = request.headers.get("Stripe-Signature")
  event = stripe.Webhook.construct_event(payload, sig, os.environ["STRIPE_WEBHOOK_SECRET"])
  if event["type"] == "checkout.session.completed":
    # 1) lookup de la intención → account_id y monto
    # 2) genera código ARK o recarga directa
    # 3) firma y guarda
    pass
  return "", 200

--- END CONTENT ---
